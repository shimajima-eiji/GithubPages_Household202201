<p data-sourcepos="1:1-2:216">導入の仕方については色々ありますが、運用の仕方については資料がなかったので、本記事では<strong>運用できるまでをゴールにしています。</strong><br>
私の環境で発生したトラブル等については以下の通り対応していますが、本来はもっと色々な問題が出る可能性があるので、追加情報程度にとらえてください。</p>
<h1 data-sourcepos="4:1-4:53">
<span id="sphinxを運用する時にハマったまとめ" class="fragment"></span><a href="#sphinx%E3%82%92%E9%81%8B%E7%94%A8%E3%81%99%E3%82%8B%E6%99%82%E3%81%AB%E3%83%8F%E3%83%9E%E3%81%A3%E3%81%9F%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>sphinxを運用する時にハマった！まとめ</h1>
<p data-sourcepos="5:1-6:156">導入自体はステキな記事がいっぱいあるので、そちらを参考にしてください。<br>
<a href="https://qiita.com/kinpira/items/505bccacb2fba89c0ff0" id="reference-ba900e18c2c89d2df1b1">sphinx でドキュメント作成からWeb公開までをやってみた(@kinpiraさん)</a></p>
<h2 data-sourcepos="8:1-8:39">
<span id="導入時のコマンドについて" class="fragment"></span><a href="#%E5%B0%8E%E5%85%A5%E6%99%82%E3%81%AE%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>導入時のコマンドについて</h2>
<p data-sourcepos="9:1-9:148">色々な記事で書かれているタイミングがそれぞれに違うので、執筆時点<sup><a href="#fn-1" id="fnref-1">1</a></sup>では以下のコマンドを使用します。</p>
<div class="code-frame" data-lang="text" data-sourcepos="11:1-13:3">
<div class="code-lang"><span class="bold">command.</span></div>
<div class="highlight"><pre><code>sphinx-apidoc -F -o ${sphinx_source_directory} ${document_project_directory}
</code></pre></div>
</div>
<p data-sourcepos="15:1-15:58">これで出力されるconf.pyが以下です（抜粋）</p>
<div class="code-frame" data-lang="python" data-sourcepos="17:1-71:3">
<div class="code-lang"><span class="bold">conf.py</span></div>
<div class="highlight"><pre><code><span class="c1"># -*- coding: utf-8 -*-
</span>
  <span class="err">～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～</span>

<span class="c1"># -- Path setup --------------------------------------------------------------
</span>
<span class="c1"># If extensions (or modules to document with autodoc) are in another directory,
# add these directories to sys.path here. If the directory is relative to the
# documentation root, use os.path.abspath to make it absolute, like shown here.
#
# import os
# import sys
# sys.path.insert(0, '(source directory)')
</span>

<span class="c1"># -- Project information -----------------------------------------------------
</span>
<span class="n">project</span> <span class="o">=</span> <span class="sh">'</span><span class="s">(your project)</span><span class="sh">'</span>
<span class="n">copyright</span> <span class="o">=</span> <span class="sh">'</span><span class="s">(now year), Author</span><span class="sh">'</span>
<span class="n">author</span> <span class="o">=</span> <span class="sh">'</span><span class="s">Author</span><span class="sh">'</span>

<span class="c1"># The short X.Y version
</span><span class="n">version</span> <span class="o">=</span> <span class="sh">''</span>
<span class="c1"># The full version, including alpha/beta/rc tags
</span><span class="n">release</span> <span class="o">=</span> <span class="sh">''</span>


<span class="c1"># -- General configuration ---------------------------------------------------
</span>
<span class="c1"># If your documentation needs a minimal Sphinx version, state it here.
#
# needs_sphinx = '1.0'
</span>
<span class="c1"># Add any Sphinx extension module names here, as strings. They can be
# extensions coming with Sphinx (named 'sphinx.ext.*') or your custom
# ones.
</span><span class="n">extensions</span> <span class="o">=</span> <span class="p">[</span>
    <span class="sh">'</span><span class="s">sphinx.ext.autodoc</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">sphinx.ext.viewcode</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">sphinx.ext.todo</span><span class="sh">'</span><span class="p">,</span>
<span class="p">]</span>

  <span class="err">～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～</span>

<span class="c1"># The language for content autogenerated by Sphinx. Refer to documentation
# for a list of supported languages.
#
# This is also used if you do content translation via gettext catalogs.
# Usually you set "language" from the command line for these cases.
</span><span class="n">language</span> <span class="o">=</span> <span class="sh">'</span><span class="s">en</span><span class="sh">'</span>

  <span class="err">～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～</span>

</code></pre></div>
</div>
<p data-sourcepos="73:1-74:39">これでも一応は動きます。<br>
が、運用上問題があります。</p>
<h1 data-sourcepos="78:1-78:62">
<span id="サブディレクトリ以下を見に行ってくれない" class="fragment"></span><a href="#%E3%82%B5%E3%83%96%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E4%BB%A5%E4%B8%8B%E3%82%92%E8%A6%8B%E3%81%AB%E8%A1%8C%E3%81%A3%E3%81%A6%E3%81%8F%E3%82%8C%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>サブディレクトリ以下を見に行ってくれない</h1>
<p data-sourcepos="79:1-79:63">とりあえず何も考えずにmake htmlとしてみると、</p>
<div class="code-frame" data-lang="text" data-sourcepos="81:1-84:3">
<div class="code-lang"><span class="bold">make_html.warning.result</span></div>
<div class="highlight"><pre><code>WARNING: autodoc: failed to import module '(your project)'; the following exception was raised:
No module named '(your project)'
</code></pre></div>
</div>
<p data-sourcepos="86:1-87:172">というエラーが出つつも、build succeeded, (any) warnings.　と、なんか出来たのか出来てないのか分からない状態になります。<br>
実際はファイルとしては存在するけど、ファイルの中身に.rstで設定（自動）されている内容が表示されない、という状態です。</p>
<h2 data-sourcepos="89:1-89:9">
<span id="原因" class="fragment"></span><a href="#%E5%8E%9F%E5%9B%A0"><i class="fa fa-link"></i></a>原因</h2>
<p data-sourcepos="90:1-91:114">sys.path.insert(0, '(source directory)')がコメントアウトされているためです。<br>
(source directory)にはパッケージのルートディレクトリを指定することで解決できます。</p>
<h2 data-sourcepos="93:1-93:34">
<span id="confpyの設定を変更する" class="fragment"></span><a href="#confpy%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>conf.pyの設定を変更する</h2>
<p data-sourcepos="95:1-96:135"><a href="http://shouhei.github.io/blog/2014/12/29/shpinxdeapifalsedokiyumentosheng-cheng-wosurushi-falsezhu-yi-dian/" rel="nofollow noopener" target="_blank">Shpinxでapiのドキュメント生成をする時の注意点（プログラミングの話さん）</a>を参考に適宜設定。</p>
<ul data-sourcepos="98:1-101:0">
<li data-sourcepos="98:1-98:62">languageは後で'ja'とかに変えておきましょう。</li>
<li data-sourcepos="99:1-99:119">この時に作成されるindex.rstなどは英語のままです。index.rstなどを直接編集しましょう。</li>
<li data-sourcepos="100:1-101:0">必要であればマークダウンを採用してもいいと思いますが、今回は使わないので触っていません。</li>
</ul>
<h1 data-sourcepos="102:1-102:101">
<span id="設定はちゃんと出来たのにサブディレクトリ以下を見に行ってくれない" class="fragment"></span><a href="#%E8%A8%AD%E5%AE%9A%E3%81%AF%E3%81%A1%E3%82%83%E3%82%93%E3%81%A8%E5%87%BA%E6%9D%A5%E3%81%9F%E3%81%AE%E3%81%AB%E3%82%B5%E3%83%96%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E4%BB%A5%E4%B8%8B%E3%82%92%E8%A6%8B%E3%81%AB%E8%A1%8C%E3%81%A3%E3%81%A6%E3%81%8F%E3%82%8C%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>設定はちゃんと出来たのに、サブディレクトリ以下を見に行ってくれない</h1>
<p data-sourcepos="103:1-104:203">忘れがちですが、make htmlの前に再ビルドする必要があります。<br>
buildしたディレクトリ以下には既にファイルがあるため、強制上書きのオプションがないとスキップされます（ログメッセージにも表示されています）</p>
<div class="code-frame" data-lang="text" data-sourcepos="106:1-108:3">
<div class="code-lang"><span class="bold">command.</span></div>
<div class="highlight"><pre><code>sphinx-apidoc -f -o ${sphinx_source_directory} ${document_project_directory}
</code></pre></div>
</div>
<p data-sourcepos="110:1-111:146">大事な事なんでもう一度書きますが、document_project_directoryはプロジェクトのルートです。<br>
つまり、${document_project_directory}/(your project)がsphinxで生成したリファレンスページのトップページになります。</p>
<h1 data-sourcepos="113:1-113:74">
<span id="それでもサブディレクトリ以下を見に行ってくれない" class="fragment"></span><a href="#%E3%81%9D%E3%82%8C%E3%81%A7%E3%82%82%E3%82%B5%E3%83%96%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E4%BB%A5%E4%B8%8B%E3%82%92%E8%A6%8B%E3%81%AB%E8%A1%8C%E3%81%A3%E3%81%A6%E3%81%8F%E3%82%8C%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>それでもサブディレクトリ以下を見に行ってくれない</h1>
<p data-sourcepos="114:1-115:81">document_project_directory以下、ネストしているディレクトリには必ず__init__.pyが必要です。<br>
これがないと当該ディレクトリ含む以下は参照されません。</p>
<p data-sourcepos="117:1-117:247">とりあえず動くかどうか見たいだけならdummyでもいいですが、dummyの状態で各モジュールのページのソースが表示出来てしまうので、運用を考慮するとしっかり書いたほうがいいです。</p>
<h1 data-sourcepos="120:1-120:65">
<span id="問題が見つかり次第随時追記していきます" class="fragment"></span><a href="#%E5%95%8F%E9%A1%8C%E3%81%8C%E8%A6%8B%E3%81%A4%E3%81%8B%E3%82%8A%E6%AC%A1%E7%AC%AC%E9%9A%8F%E6%99%82%E8%BF%BD%E8%A8%98%E3%81%97%E3%81%A6%E3%81%84%E3%81%8D%E3%81%BE%E3%81%99"><i class="fa fa-link"></i></a>問題が見つかり次第、随時追記していきます。</h1>
<h1 data-sourcepos="123:1-123:8">
<span id="補足" class="fragment"></span><a href="#%E8%A3%9C%E8%B6%B3"><i class="fa fa-link"></i></a>補足</h1>
<p data-sourcepos="124:1-125:139"><a href="https://qiita.com/mikanbako/items/28a3fc5d1da42939f941" id="reference-27dc10de1d550c207429">sphinx-autobuildで再ビルド、ブラウザの再リロードの手間を省いてSphinx文書をサクサク作成(@mikanbakoさん)</a>がステキすぎた。<br>
上記問題が解決した後はsphinx-autobuildに任せて直接rstとかを書き換えてしまってもいいかもしれません。</p>
<h1 data-sourcepos="127:1-127:47">
<span id="読了後いいねをお願いします" class="fragment"></span><a href="#%E8%AA%AD%E4%BA%86%E5%BE%8C%E3%81%84%E3%81%84%E3%81%AD%E3%82%92%E3%81%8A%E9%A1%98%E3%81%84%E3%81%97%E3%81%BE%E3%81%99"><i class="fa fa-link"></i></a>読了後いいね！をお願いします。</h1>
<p data-sourcepos="128:1-128:150">どれだけの方に読んでもらっているか知りたいので、お手数をおかけしますがご協力いただけると嬉しいです。</p>
<section class="footnotes">
<ol>
<li id="fn-1">
<p data-sourcepos="76:7-76:55">コマンド選定時の執筆時点：2018/05/24 <a href="#fnref-1" class="">↩</a></p>
</li>
</ol>
</section>
